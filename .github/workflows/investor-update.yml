name: Daily Investor Update

on:
  schedule:
    # Läuft täglich um 12:00 Uhr MEZ/MESZ (Berlin)
    # Zwei Cron-Jobs für Winter- und Sommerzeit:
    # - 11:00 UTC = 12:00 MEZ (Winter: Oktober-März)
    # - 10:00 UTC = 12:00 MESZ (Sommer: April-September)
    # Der Workflow prüft die aktuelle Berliner Zeit und führt nur bei 12:00 aus
    - cron: '0 11 * * *'  # 12:00 MEZ (Winter)
    - cron: '0 10 * * *'  # 12:00 MESZ (Sommer)
  workflow_dispatch: # Manuell auslösbar

jobs:
  update-report:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: Prüfe Zeitzone und führe Update aus
        run: |
          # Aktuelle Zeit in Berliner Zeitzone (MEZ/MESZ)
          BERLIN_HOUR=$(TZ=Europe/Berlin date +%H)
          BERLIN_MINUTE=$(TZ=Europe/Berlin date +%M)
          
          # Nur ausführen, wenn es genau 12:00 MEZ/MESZ ist
          if [ "$BERLIN_HOUR" = "12" ] && [ "$BERLIN_MINUTE" = "00" ]; then
            echo "✅ Zeit ist 12:00 MEZ/MESZ - führe Update aus"
            node scripts/update-investor-report.js
          else
            echo "⏭️  Nicht die richtige Zeit (aktuell: ${BERLIN_HOUR}:${BERLIN_MINUTE} MEZ/MESZ) - überspringe Update"
            exit 0
          fi
      
      - name: Commit & Push if Changed
        if: success()
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add docs/investor_update_7_tage.md
          git diff --staged --quiet || (git commit -m "Auto-update: Investor Report $(date +'%d.%m.%Y')" && git push)

